<head>
    <link rel="stylesheet" href="https://bootswatch.com/5/cosmo/bootstrap.min.css">
    <link rel="stylesheet" href="../styles/mystyles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <script type=module src="../header.js"></script>

</head>

<body>
    <main-header></main-header>
    <div class="section-container">
        <h1>Gesti√≥n de inventario</h1>
    </div>

    <div>
        <!doctype html>
        <title>Upload new File</title>
        <h1>Upload new File</h1>
        <form method=post enctype=multipart/form-data>
            <input type=file name=file>
            <button onclick="getCompras(event)">Suir archivo</button>
        </form>
    </div>
    <p id="dynamic"></p>

    <div id="myData"></div>
    <div class="container">
        <table class="table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Descripcion</th>
                </tr>
            </thead>
            <tbody id="data">

            </tbody>
        </table>
    </div </p>
</body>

<script>

    async function Upload() {
        const formData = new FormData();
        const fileField = document.querySelector('input[type="file"]');
        formData.append('file', fileField.files[0]);
        const response = await fetch('http://127.0.0.1:5000/documento', {
            method: 'POST',
            body: formData
        })
        const contentType = response.headers.get("content-type");
        console.log(contentType)
        const compras = await response.json()
        console.log(compras);
        return compras;
    }

    async function getCompras(e) {
        e.preventDefault();
        e.stopPropagation();
        Upload().then(
            data => {
                var mainContainer = document.getElementById("myData");
                var temp = "";
                const info = JSON.parse(JSON.parse(data.info));
                // const prods = JSON.parse(JSON.parse(data.productos));
                console.log(info);
                for (key in info) {
                    if (info.hasOwnProperty(key)) {
                        var div = document.createElement("div");
                        div.innerHTML = key + " : " + info[key];
                        mainContainer.appendChild(div);
                    }
                }
                //const prods = JSON.parse(data.producto); //array
                const prods = JSON.parse(data.productos);
                console.log(prods);
                var temp = "";
                prods.forEach((itemData) => {
                    temp += "<tr>";
                    temp += "<td>" + itemData.idProducto + "</td>";
                    temp += "<td>" + itemData.nombre + "</td>";
                    temp += "<td>" + itemData.descripcion + "</td></tr>";
                });
                document.getElementById('data').innerHTML = temp
            }
        )
    }
</script>